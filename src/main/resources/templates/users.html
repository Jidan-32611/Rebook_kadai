<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <title>ユーザー管理</title>
  <link rel="stylesheet" th:href="@{/css/style.css}"/>
</head>
<body>
<div class="container">
<h1>ユーザー管理</h1>

<form method="get" th:action="@{/admin/users}" style="margin-bottom:1rem;">
  <input type="text" name="q" th:value="${q}" placeholder="名前・メールで検索"/>
  <select name="role">
    <option th:value="" th:selected="${role == null or role == ''}">すべてのロール</option>
    <option th:value="'USER'"  th:selected="${role == 'USER'}">USER</option>
    <option th:value="'ADMIN'" th:selected="${role == 'ADMIN'}">ADMIN</option>
  </select>
  <select name="banned">
    <option th:value="${null}" th:selected="${banned == null}">BAN状態: 全て</option>
    <option th:value="false" th:selected="${banned == false}">未BAN</option>
    <option th:value="true"  th:selected="${banned == true}">BAN中</option>
  </select>
  <button type="submit">絞り込み</button>
</form>

<table border="1" cellspacing="0" cellpadding="6">
  <thead>
  <tr>
    <th>ID</th><th>名前</th><th>メール</th><th>ロール</th>
    <th>enabled</th><th>banned</th><th>ban理由</th><th>ban日時</th><th>操作</th>
  </tr>
  </thead>
  <tbody>
  <tr th:each="u : ${users}">
    <td th:text="${u.id}"></td>
    <td th:text="${u.name}"></td>
    <td th:text="${u.email}"></td>
    <td th:text="${u.role}"></td>
    <td th:text="${u.enabled}"></td>
    <td th:text="${u.banned}"></td>
    <td th:text="${u.banReason}"></td>
    <td th:text="${u.bannedAt}"></td>
    <td>
      <div th:if="${!u.banned}">
        <form th:action="@{|/admin/users/${u.id}/ban|}" method="post" style="display:inline;">
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
          <input type="hidden" name="q" th:value="${q}"/>
          <input type="hidden" name="role" th:value="${role}"/>
          <input type="hidden" name="banned" th:value="${banned}"/>
          <input type="text" name="reason" placeholder="理由 (任意)"/>
          <button type="submit">BAN</button>
        </form>
      </div>
      <div th:if="${u.banned}">
        <form th:action="@{|/admin/users/${u.id}/unban|}" method="post" style="display:inline;">
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
          <input type="hidden" name="q" th:value="${q}"/>
          <input type="hidden" name="role" th:value="${role}"/>
          <input type="hidden" name="banned" th:value="${banned}"/>
          <button type="submit">BAN解除</button>
        </form>
      </div>
    </td>
  </tr>
  </tbody>
</table>
</div>
</body>
</html>
